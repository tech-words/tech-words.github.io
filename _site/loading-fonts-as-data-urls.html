<!doctype html>

<!--
## Features:

- Keep CSS inline: It will be small enough not to add much weight to the page, which means it's better to avoid the extra HTTP call to request CSS
- Use system fonts: But it's hard to find a nice system font for both Linux, Windows and MacOS

- Google colours for links
- Visual box around article to highlight it
- Navigation - don't get in the way
- 

JavaScript:

- Only use enhancements that aren't necessary:
  - Document outline on the left
  - Add "title" to links

-->

<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Loading fonts as Data URLs for performance</title>

  <meta name="description" content="Including your fonts inside your CSS files as Data URLs can help with performance">

  <!-- Social media -->
  <meta property='article:author' content='https://twitter.com/nottrobin' />
  <meta property='article:publisher' content='https://robinwinslow.uk' />
  <meta property="og:image" content="https://www.thebluediamondgallery.com/tablet/images/blog.jpg" />
  <meta property="og:url" content="https://robinwinslow.uk/loading-fonts-as-data-urls" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Loading fonts as Data URLs for performance" />
  <!-- Keep Terry Pratchett alive in the network https://xclacksoverhead.org/home/about -->
  <meta http-equiv="x-clacks-overhead" content="GNU Terry Pratchett" />

  <link type="application/atom+xml" rel="alternative" href="/rss.xml" />

  <style>
    /**
       * Font size
       * 
       * For usability, bigger text is almost always better. People continue to Especially as resolutions get higher
       * 
       */

    body {
      font-family: "dejavu Sans light", sans-serif;
      font-size: 1.5rem;
      background-color: #efefef;
      margin: 0;
    }

    time,
    .subtitle {
      color: #767676;
    }

    h1,
    h2,
    h3,
    h4 {
      font-weight: normal;
      margin-top: 2em;
      margin-bottom: 1em;
    }

    h1 {
      font-size: 2em;
    }

    h2 {
      font-size: 1.5em;
    }

    h3 {
      font-size: 1.2em;
    }

    h4 {
      font-size: 1.1em;
    }

    p {
      line-height: 1.5em;
    }

    a {
      color: #1a0dab;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    a:visited {
      color: #551A8B;
    }

    input,
    button {
      appearance: none;
      border: 1px solid lightgray;
      font-size: 1em;
      max-width: 100%;
      padding: 0.5em 0.8em;
    }

    article {
      margin: auto;
      padding: 3em 5em;
      max-width: 35em;
      background-color: white;
    }

    @media (max-width: 1080px) {
      article {
        padding: 0.5em 1.5em;
      }
    }

    article p,
    article ul,
    article ol {
      margin-block-start: 1.5em;
      margin-block-end: 1.5em;
    }

    article li {
      margin-block-start: 1em;
      margin-block-end: 1em;
      line-height: 1.5em;
    }

    blockquote {
      padding: 1em 1.5em;
      margin: 1.5em 0;
      border-left: 2px solid #ddd;
      font-style: italic;
    }

    blockquote p {
      display: inline;
    }

    pre {
      overflow-x: auto;
      background-color: #eee;
      padding: 1em;
      line-height: 125%;
    }

    img {
      max-width: 100%;
    }

    code {
      padding: 0.125em 0.25em;
      line-height: 1.6em;
      margin: 0;
      font-size: 0.8em;
      background-color: #f0f0f0;
      border-radius: 6px;
    }

    pre code {
      line-height: inherit;
      padding: 0;
    }

    hr {
      margin: 3em 0;
    }

    /* Classes */
    .article-header {
      margin: auto;
      max-width: 60em;
      padding: 3em 1em;
      text-align: center;
    }

    .article-header h1 {
      font-size: 3em;
      margin: 0 0 0.5em 0;
    }

    @media (max-width: 1080px) {
      .article-header h1 {
        font-size: 2.3em;
      }
    }

    .back-to-home {
      padding: 0 1.5em;
    }

    .title {
      text-align: center;
      margin: 1em 1em 2em 1em;
    }

    .title h1 {
      margin-bottom: 0;
    }

    .title p {
      margin-top: 0.25em;
    }

    .search-form {
      text-align: center;
      margin: 0.8em 1em;
    }

    .search-form input,
    .search-form button {
      margin: 0.2em 0;
    }

    .posts li {
      margin: 3em 0;
    }

    .posts li article {
      padding: 0.5em 3em;
    }

    .posts li article .date {
      margin-top: 0.5em;
      font-size: 0.8em;
    }

    @media (max-width: 984px) {
      .posts li article {
        padding: 1.5em;
      }
    }

    .posts li article h1 {
      font-size: 1.5em;
      margin: 1em 0 0 0;
      font-weight: normal;
    }

    @media (max-width: 984px) {
      .posts li article h1 {
        font-size: 1.3em;
      }
    }

    .posts {
      padding: 0;
      margin: 0;
      list-style-type: none;
    }

    .see-the-code {
      padding: 1.5em;
      font-size: 0.8em;
      text-align: right;
    }

    .discuss {
      text-align: center;
      font-style: italic;
    }

    .author {
      text-align: center;
      margin: 3em;
      font-style: normal;
    }

    .more-posts {
      padding: 1.5em 3em;
      margin: auto;
      background-color: white;
      max-width: 35em;
    }

    .more-posts h2 {
      margin-top: 1em;
    }

    .more-posts time {
      font-size: 0.8em;
    }

    .headings {
      position: absolute;
      text-align: right;
      font-size: 0.8em;
      opacity: 0.5;
      position: fixed;
      display: none;
    }

    .headings ol {
      margin: 6em 6em 1.5em 1.5em;
      padding: 0;
    }

    .headings ol li {
      list-style-type: none;
      margin: 1.5em 0 0 0;
    }

    .headings ol li.h2 {
      font-size: 0.8em;
      opacity: 0.8;
      margin: 0.7em 0 0 0;
    }

    .heading-link {
      opacity: 0.4;
      font-size: 2rem;
    }

    table {
      border-spacing: 0;
      font-size: 0.8em;
    }

    td {
      padding: 1em;
      border-left: 1px dotted #666;
      border-top: 1px dotted #666;
    }

    td:last-child {
      border-right: 1px dotted #666;
    }

    tr:last-child td {
      border-bottom: 1px dotted #666;
    }

    /* Pygments syntax highlighting autumn theme */
    td.linenos pre {
      color: #000000;
      background-color: #f0f0f0;
      padding-left: 5px;
      padding-right: 5px;
    }

    span.linenos {
      color: #000000;
      background-color: #f0f0f0;
      padding-left: 5px;
      padding-right: 5px;
    }

    td.linenos pre.special {
      color: #000000;
      background-color: #ffffc0;
      padding-left: 5px;
      padding-right: 5px;
    }

    span.linenos.special {
      color: #000000;
      background-color: #ffffc0;
      padding-left: 5px;
      padding-right: 5px;
    }

    .highlight .hll {
      background-color: #ffffcc
    }

    .highlight {
      background: #f0f0f0;
    }

    .highlight .c {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .err {
      border: 1px solid #FF0000
    }

    .highlight .k {
      color: #007020;
      font-weight: bold
    }

    .highlight .o {
      color: #666666
    }

    .highlight .ch {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cm {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cp {
      color: #007020
    }

    .highlight .cpf {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .c1 {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cs {
      color: #60a0b0;
      background-color: #fff0f0
    }

    .highlight .gd {
      color: #A00000
    }

    .highlight .ge {
      font-style: italic
    }

    .highlight .gr {
      color: #FF0000
    }

    .highlight .gh {
      color: #000080;
      font-weight: bold
    }

    .highlight .gi {
      color: #00A000
    }

    .highlight .go {
      color: #888888
    }

    .highlight .gp {
      color: #c65d09;
      font-weight: bold
    }

    .highlight .gs {
      font-weight: bold
    }

    .highlight .gu {
      color: #800080;
      font-weight: bold
    }

    .highlight .gt {
      color: #0044DD
    }

    .highlight .kc {
      color: #007020;
      font-weight: bold
    }

    .highlight .kd {
      color: #007020;
      font-weight: bold
    }

    .highlight .kn {
      color: #007020;
      font-weight: bold
    }

    .highlight .kp {
      color: #007020
    }

    .highlight .kr {
      color: #007020;
      font-weight: bold
    }

    .highlight .kt {
      color: #902000
    }

    .highlight .m {
      color: #40a070
    }

    .highlight .s {
      color: #4070a0
    }

    .highlight .na {
      color: #4070a0
    }

    .highlight .nb {
      color: #007020
    }

    .highlight .nc {
      color: #0e84b5;
      font-weight: bold
    }

    .highlight .no {
      color: #60add5
    }

    .highlight .nd {
      color: #555555;
      font-weight: bold
    }

    .highlight .ni {
      color: #d55537;
      font-weight: bold
    }

    .highlight .ne {
      color: #007020
    }

    .highlight .nf {
      color: #06287e
    }

    .highlight .nl {
      color: #002070;
      font-weight: bold
    }

    .highlight .nn {
      color: #0e84b5;
      font-weight: bold
    }

    .highlight .nt {
      color: #062873;
      font-weight: bold
    }

    .highlight .nv {
      color: #bb60d5
    }

    .highlight .ow {
      color: #007020;
      font-weight: bold
    }

    .highlight .w {
      color: #bbbbbb
    }

    .highlight .mb {
      color: #40a070
    }

    .highlight .mf {
      color: #40a070
    }

    .highlight .mh {
      color: #40a070
    }

    .highlight .mi {
      color: #40a070
    }

    .highlight .mo {
      color: #40a070
    }

    .highlight .sa {
      color: #4070a0
    }

    .highlight .sb {
      color: #4070a0
    }

    .highlight .sc {
      color: #4070a0
    }

    .highlight .dl {
      color: #4070a0
    }

    .highlight .sd {
      color: #4070a0;
      font-style: italic
    }

    .highlight .s2 {
      color: #4070a0
    }

    .highlight .se {
      color: #4070a0;
      font-weight: bold
    }

    .highlight .sh {
      color: #4070a0
    }

    .highlight .si {
      color: #70a0d0;
      font-style: italic
    }

    .highlight .sx {
      color: #c65d09
    }

    .highlight .sr {
      color: #235388
    }

    .highlight .s1 {
      color: #4070a0
    }

    .highlight .ss {
      color: #517918
    }

    .highlight .bp {
      color: #007020
    }

    .highlight .fm {
      color: #06287e
    }

    .highlight .vc {
      color: #bb60d5
    }

    .highlight .vg {
      color: #bb60d5
    }

    .highlight .vi {
      color: #bb60d5
    }

    .highlight .vm {
      color: #bb60d5
    }

    .highlight .il {
      color: #40a070
    }
  </style>
</head>

<body>
  <nav class="back-to-home">
  <p><a href="/">← Posts</a></h1></p>
</nav>

<header class="article-header">
  <h1>Loading fonts as Data URLs for performance</h1>
  <time datetime="2013-06-19">19th June 2013</time>
</header>

<nav class="headings">
  <ol>
    <li><a href="#top">↑ top</a></li>
  </ol>
</nav>

<article>
  <p>With the advent of <a href="https://en.wikipedia.org/wiki/Web_typography#Web_fonts">web fonts</a> (e.g. from <a href="https://www.google.com/fonts/">Google Fonts</a>), thankfully web designers are no longer tied to a limited set of “web safe” fonts.</p>

<h2 id="fonts-and-performance">Fonts and performance</h2>

<p>However, there is a potential performance hit with this. You will need to link your CSS files to the font files. The problem here isn’t so much the size of the font file (they are typically under 100 KB), it’s more that each new HTTP request that a page makes <a href="http://developer.yahoo.com/performance/rules.html">effects performance</a></p>

<p>Also, when loading web fonts externally you will sometimes see a flicker where the page loads initially with the default browser fonts, and then the new fonts are downloaded and applied afterwards. This flicker can look quite unprofessional.</p>

<h2 id="font-formats-and-ie8">Font formats and IE8</h2>

<p>If you want to support Internet Explorer 8 or older, you unfortunately need to include your fonts in two formats: <a href="https://en.wikipedia.org/wiki/Woff">WOFF</a> and <a href="https://en.wikipedia.org/wiki/Embedded_OpenType">EOT</a>.</p>

<p>However, if you’re willing to drop IE8 support (and <a href="/2013/02/28/time-to-say-goodbye-to-ie8/">reap the benefits</a>), or to simply serve the browser default font to IE8, then you can provide your fonts in WOFF only, which is supported by <a href="http://caniuse.com/#search=woff">all other relevant browsers</a>.</p>

<h2 id="data-urls">Data URLs</h2>

<p>So <a href="http://dataurl.net/#about">Data URLs</a>, if you haven’t heard of them, are a way of encoding binary data as a valid URL string. This means the data can be included directly inside HTML or CSS files. They are fantastically easy to create by simply dragging your binary file into the <a href="http://dataurl.net/#dataurlmaker">Data URL Creator</a>.</p>

<p>Data URLs are likely to be a bit larger than the binary file would have been. In my experience they tend to be about 20% larger. So the larger the file you’re dealing with the less practical it becomes to encode the file as a URL. However, for sub-100k web fonts this difference is not so important.</p>

<p>So using Data URLs, you can include your font directly in your CSS like so:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* http://www.google.com/webfonts/specimen/Lato */</span>
<span class="k">@font-face</span> <span class="p">{</span>
    <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Lato light'</span><span class="p">;</span>
    <span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
    <span class="nl">font-weight</span><span class="p">:</span> <span class="m">300</span><span class="p">;</span>
    <span class="nl">src</span><span class="p">:</span> <span class="n">local</span><span class="p">(</span><span class="s2">'Lato Light'</span><span class="p">),</span> <span class="sx">url('data:application/x-font-woff;base64,d09GRg...BQAAAAB')</span><span class="p">,</span> <span class="n">format</span><span class="p">(</span><span class="s2">'woff'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>(For example, <a href="https://github.com/nottrobin/robinwinslow.uk/blob/master/_assets/stylesheets/global.scss#L345">here’s what I use for this very site</a>)</p>

<p>This will now mean that your web pages will only have to download one CSS file, rather than a CSS file and a bunch of font files, which will help performance. Personally I think it’s also neat not to have to create a special directory for font files. Keeping it all in one place (CSS) just seems nice and neat to me.</p>

<h2 id="a-word-about-caching">A word about caching</h2>

<p>Whether the above suggestion is actually a good idea will depend on how often your CSS changes. Hopefully you’ll be merging your CSS files into one file already to reduce HTTP requests. This of course means that whenever that merged CSS file changes, your users will have to download the whole file again to see your changes.</p>

<p>If your fonts were downloaded as separate files, rather than being included in your CSS, then the fonts may well be cached even if the CSS has changed. However, if you include your fonts inside your CSS files as suggested above, this will mean that whenever your CSS changes a much larger CSS file will have to be downloaded each time. Including your fonts inside your CSS is likely to double the size of your CSS file.</p>

<p>This is a complex decision, but to give you some rough advice I’d say - if you CSS changes more than a couple of times a month then keep your fonts as separate files. If it’s less often (as it is with this site) then it’s probably worth including them inside the CSS as Data URLs.</p>

<p>If you have a different opinion on this, please let me know in the comments.</p>


  
</article>

<script>
  /**
   * Document outline
   */

  // Get elements
  let article = document.querySelector("article");
  let headings = document.querySelector(".headings");
  let list = headings.querySelector("ol");

  // Populate nav
  article.querySelectorAll("h1, h2").forEach(function (heading) {
    let item = document.createElement("li");
    item.classList.add(heading.tagName.toLowerCase());
    item.innerHTML = `<a href="#${heading.id}">${heading.textContent}</a>`;
    list.appendChild(item);
  });

  function toggleHeadings() {
    // Don't show if there's not space
    if (article.offsetLeft < 180) {
      headings.style.display = "none";
      return;
    }

    // More compact layout
    if (article.offsetLeft < 350) {
      list.style.marginRight = "1.5em";
    } else {
      list.style.marginRight = "6em";
    }

    let articleBounding = article.getBoundingClientRect();
    let rightOffset = document.body.offsetWidth - articleBounding.left;

    headings.style.display = "block";
    headings.style.right = rightOffset + "px";

    if (articleBounding.top > 0) {
      headings.style.top = articleBounding.top + "px";
    } else {
      headings.style.top = 0;
    }
  }

  window.addEventListener('scroll', toggleHeadings);
  window.addEventListener('resize', toggleHeadings);

  toggleHeadings();
</script>

<address class="author">
  By <a href="https://twitter.com/nottrobin">@nottrobin</a>
</address>





<nav class="more-posts">
  <h2>More posts</h2>
  
  <p>
    <a href="/blogging-from-my-phone-with-gitjournal">Blogging from my phone with GitJournal</a><br>
    <time datetime="2022-06-05">5th June 2022</time>
  </p>
  
  
  <p>
    <a href="/a-rant-about-buffering">Youtube annoyances - a rant about buffering</a><br>
    <time datetime="2013-06-22">22nd June 2013</time>
  </p>
  
  
  <p>
    <a href="/social-morals-a-statement-of-values">Social morals - a statement of values</a><br>
    <time datetime="2013-06-17">17th June 2013</time>
  </p>
  
</nav>


  <footer class="see-the-code">
    <a href="https://github.com/nottrobin/robinwinslow.uk">☵ See the code</a>
  </footer>

  <!-- Instant.page -->
  <script>
    let mouseoverTimer; let lastTouchTimestamp; const prefetches = new Set; const prefetchElement = document.createElement("link"); const isSupported = prefetchElement.relList && prefetchElement.relList.supports && prefetchElement.relList.supports("prefetch") && window.IntersectionObserver && "isIntersecting" in IntersectionObserverEntry.prototype; const allowQueryString = "instantAllowQueryString" in document.body.dataset; const allowExternalLinks = "instantAllowExternalLinks" in document.body.dataset; const useWhitelist = "instantWhitelist" in document.body.dataset; const mousedownShortcut = "instantMousedownShortcut" in document.body.dataset; const DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION = 1111; let delayOnHover = 65; let useMousedown = false; let useMousedownOnly = false; let useViewport = false; if ("instantIntensity" in document.body.dataset) { const intensity = document.body.dataset.instantIntensity; if (intensity.substr(0, "mousedown".length) == "mousedown") { useMousedown = true; if (intensity == "mousedown-only") { useMousedownOnly = true } } else if (intensity.substr(0, "viewport".length) == "viewport") { if (!(navigator.connection && (navigator.connection.saveData || navigator.connection.effectiveType && navigator.connection.effectiveType.includes("2g")))) { if (intensity == "viewport") { if (document.documentElement.clientWidth * document.documentElement.clientHeight < 45e4) { useViewport = true } } else if (intensity == "viewport-all") { useViewport = true } } } else { const milliseconds = parseInt(intensity); if (!isNaN(milliseconds)) { delayOnHover = milliseconds } } } if (isSupported) { const eventListenersOptions = { capture: true, passive: true }; if (!useMousedownOnly) { document.addEventListener("touchstart", touchstartListener, eventListenersOptions) } if (!useMousedown) { document.addEventListener("mouseover", mouseoverListener, eventListenersOptions) } else if (!mousedownShortcut) { document.addEventListener("mousedown", mousedownListener, eventListenersOptions) } if (mousedownShortcut) { document.addEventListener("mousedown", mousedownShortcutListener, eventListenersOptions) } if (useViewport) { let triggeringFunction; if (window.requestIdleCallback) { triggeringFunction = (callback => { requestIdleCallback(callback, { timeout: 1500 }) }) } else { triggeringFunction = (callback => { callback() }) } triggeringFunction(() => { const intersectionObserver = new IntersectionObserver(entries => { entries.forEach(entry => { if (entry.isIntersecting) { const linkElement = entry.target; intersectionObserver.unobserve(linkElement); preload(linkElement.href) } }) }); document.querySelectorAll("a").forEach(linkElement => { if (isPreloadable(linkElement)) { intersectionObserver.observe(linkElement) } }) }) } } function touchstartListener(event) { lastTouchTimestamp = performance.now(); const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } preload(linkElement.href) } function mouseoverListener(event) { if (performance.now() - lastTouchTimestamp < DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION) { return } const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } linkElement.addEventListener("mouseout", mouseoutListener, { passive: true }); mouseoverTimer = setTimeout(() => { preload(linkElement.href); mouseoverTimer = undefined }, delayOnHover) } function mousedownListener(event) { const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } preload(linkElement.href) } function mouseoutListener(event) { if (event.relatedTarget && event.target.closest("a") == event.relatedTarget.closest("a")) { return } if (mouseoverTimer) { clearTimeout(mouseoverTimer); mouseoverTimer = undefined } } function mousedownShortcutListener(event) { if (performance.now() - lastTouchTimestamp < DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION) { return } const linkElement = event.target.closest("a"); if (event.which > 1 || event.metaKey || event.ctrlKey) { return } if (!linkElement) { return } linkElement.addEventListener("click", function (event) { if (event.detail == 1337) { return } event.preventDefault() }, { capture: true, passive: false, once: true }); const customEvent = new MouseEvent("click", { view: window, bubbles: true, cancelable: false, detail: 1337 }); linkElement.dispatchEvent(customEvent) } function isPreloadable(linkElement) { if (!linkElement || !linkElement.href) { return } if (useWhitelist && !("instant" in linkElement.dataset)) { return } if (!allowExternalLinks && linkElement.origin != location.origin && !("instant" in linkElement.dataset)) { return } if (!["http:", "https:"].includes(linkElement.protocol)) { return } if (linkElement.protocol == "http:" && location.protocol == "https:") { return } if (!allowQueryString && linkElement.search && !("instant" in linkElement.dataset)) { return } if (linkElement.hash && linkElement.pathname + linkElement.search == location.pathname + location.search) { return } if ("noInstant" in linkElement.dataset) { return } return true } function preload(url) { if (prefetches.has(url)) { return } const prefetcher = document.createElement("link"); prefetcher.rel = "prefetch"; prefetcher.href = url; document.head.appendChild(prefetcher); prefetches.add(url) }
  </script>
</body>

</html>
