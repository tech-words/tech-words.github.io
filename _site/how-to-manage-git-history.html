<!doctype html>

<!--
## Features:

- Keep CSS inline: It will be small enough not to add much weight to the page, which means it's better to avoid the extra HTTP call to request CSS
- Use system fonts: But it's hard to find a nice system font for both Linux, Windows and MacOS

- Google colours for links
- Visual box around article to highlight it
- Navigation - don't get in the way
- 

JavaScript:

- Only use enhancements that aren't necessary:
  - Document outline on the left
  - Add "title" to links

-->

<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How to manage your Git history: Tips for keeping your commits tidy</title>

  <meta name="description" content="A number of techniques I use frequently for maintaining control over my Git commit history in my feature branches.">

  <!-- Social media -->
  <meta property='article:author' content='https://twitter.com/nottrobin' />
  <meta property='article:publisher' content='https://robinwinslow.uk' />
  <meta property="og:image" content="https://www.thebluediamondgallery.com/tablet/images/blog.jpg" />
  <meta property="og:url" content="https://robinwinslow.uk/how-to-manage-git-history" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="How to manage your Git history: Tips for keeping your commits tidy" />
  <!-- Keep Terry Pratchett alive in the network https://xclacksoverhead.org/home/about -->
  <meta http-equiv="x-clacks-overhead" content="GNU Terry Pratchett" />

  <link type="application/atom+xml" rel="alternative" href="/rss.xml" />

  <style>
    /**
       * Font size
       * 
       * For usability, bigger text is almost always better. People continue to Especially as resolutions get higher
       * 
       */

    body {
      font-family: "dejavu Sans light", sans-serif;
      font-size: 1.5rem;
      background-color: #efefef;
      margin: 0;
    }

    time,
    .subtitle {
      color: #767676;
    }

    h1,
    h2,
    h3,
    h4 {
      font-weight: normal;
      margin-top: 2em;
      margin-bottom: 1em;
    }

    h1 {
      font-size: 2em;
    }

    h2 {
      font-size: 1.5em;
    }

    h3 {
      font-size: 1.2em;
    }

    h4 {
      font-size: 1.1em;
    }

    p {
      line-height: 1.5em;
    }

    a {
      color: #1a0dab;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    a:visited {
      color: #551A8B;
    }

    input,
    button {
      appearance: none;
      border: 1px solid lightgray;
      font-size: 1em;
      max-width: 100%;
      padding: 0.5em 0.8em;
    }

    article {
      margin: auto;
      padding: 3em 5em;
      max-width: 35em;
      background-color: white;
    }

    @media (max-width: 1080px) {
      article {
        padding: 0.5em 1.5em;
      }
    }

    article p,
    article ul,
    article ol {
      margin-block-start: 1.5em;
      margin-block-end: 1.5em;
    }

    article li {
      margin-block-start: 1em;
      margin-block-end: 1em;
      line-height: 1.5em;
    }

    blockquote {
      padding: 1em 1.5em;
      margin: 1.5em 0;
      border-left: 2px solid #ddd;
      font-style: italic;
    }

    blockquote p {
      display: inline;
    }

    pre {
      overflow-x: auto;
      background-color: #eee;
      padding: 1em;
      line-height: 125%;
    }

    img {
      max-width: 100%;
    }

    code {
      padding: 0.125em 0.25em;
      line-height: 1.6em;
      margin: 0;
      font-size: 0.8em;
      background-color: #f0f0f0;
      border-radius: 6px;
    }

    pre code {
      line-height: inherit;
      padding: 0;
    }

    hr {
      margin: 3em 0;
    }

    /* Classes */
    .article-header {
      margin: auto;
      max-width: 60em;
      padding: 3em 1em;
      text-align: center;
    }

    .article-header h1 {
      font-size: 3em;
      margin: 0 0 0.5em 0;
    }

    @media (max-width: 1080px) {
      .article-header h1 {
        font-size: 2.3em;
      }
    }

    .back-to-home {
      padding: 0 1.5em;
    }

    .title {
      text-align: center;
      margin: 1em 1em 2em 1em;
    }

    .title h1 {
      margin-bottom: 0;
    }

    .title p {
      margin-top: 0.25em;
    }

    .search-form {
      text-align: center;
      margin: 0.8em 1em;
    }

    .search-form input,
    .search-form button {
      margin: 0.2em 0;
    }

    .posts li {
      margin: 3em 0;
    }

    .posts li article {
      padding: 0.5em 3em;
    }

    .posts li article .date {
      margin-top: 0.5em;
      font-size: 0.8em;
    }

    @media (max-width: 984px) {
      .posts li article {
        padding: 1.5em;
      }
    }

    .posts li article h1 {
      font-size: 1.5em;
      margin: 1em 0 0 0;
      font-weight: normal;
    }

    @media (max-width: 984px) {
      .posts li article h1 {
        font-size: 1.3em;
      }
    }

    .posts {
      padding: 0;
      margin: 0;
      list-style-type: none;
    }

    .see-the-code {
      padding: 1.5em;
      font-size: 0.8em;
      text-align: right;
    }

    .discuss {
      text-align: center;
      font-style: italic;
    }

    .author {
      text-align: center;
      margin: 3em;
      font-style: normal;
    }

    .more-posts {
      padding: 1.5em 3em;
      margin: auto;
      background-color: white;
      max-width: 35em;
    }

    .more-posts h2 {
      margin-top: 1em;
    }

    .more-posts time {
      font-size: 0.8em;
    }

    .headings {
      position: absolute;
      text-align: right;
      font-size: 0.8em;
      opacity: 0.5;
      position: fixed;
      display: none;
    }

    .headings ol {
      margin: 6em 6em 1.5em 1.5em;
      padding: 0;
    }

    .headings ol li {
      list-style-type: none;
      margin: 1.5em 0 0 0;
    }

    .headings ol li.h2 {
      font-size: 0.8em;
      opacity: 0.8;
      margin: 0.7em 0 0 0;
    }

    .heading-link {
      opacity: 0.4;
      font-size: 2rem;
    }

    table {
      border-spacing: 0;
      font-size: 0.8em;
    }

    td {
      padding: 1em;
      border-left: 1px dotted #666;
      border-top: 1px dotted #666;
    }

    td:last-child {
      border-right: 1px dotted #666;
    }

    tr:last-child td {
      border-bottom: 1px dotted #666;
    }

    /* Pygments syntax highlighting autumn theme */
    td.linenos pre {
      color: #000000;
      background-color: #f0f0f0;
      padding-left: 5px;
      padding-right: 5px;
    }

    span.linenos {
      color: #000000;
      background-color: #f0f0f0;
      padding-left: 5px;
      padding-right: 5px;
    }

    td.linenos pre.special {
      color: #000000;
      background-color: #ffffc0;
      padding-left: 5px;
      padding-right: 5px;
    }

    span.linenos.special {
      color: #000000;
      background-color: #ffffc0;
      padding-left: 5px;
      padding-right: 5px;
    }

    .highlight .hll {
      background-color: #ffffcc
    }

    .highlight {
      background: #f0f0f0;
    }

    .highlight .c {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .err {
      border: 1px solid #FF0000
    }

    .highlight .k {
      color: #007020;
      font-weight: bold
    }

    .highlight .o {
      color: #666666
    }

    .highlight .ch {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cm {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cp {
      color: #007020
    }

    .highlight .cpf {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .c1 {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cs {
      color: #60a0b0;
      background-color: #fff0f0
    }

    .highlight .gd {
      color: #A00000
    }

    .highlight .ge {
      font-style: italic
    }

    .highlight .gr {
      color: #FF0000
    }

    .highlight .gh {
      color: #000080;
      font-weight: bold
    }

    .highlight .gi {
      color: #00A000
    }

    .highlight .go {
      color: #888888
    }

    .highlight .gp {
      color: #c65d09;
      font-weight: bold
    }

    .highlight .gs {
      font-weight: bold
    }

    .highlight .gu {
      color: #800080;
      font-weight: bold
    }

    .highlight .gt {
      color: #0044DD
    }

    .highlight .kc {
      color: #007020;
      font-weight: bold
    }

    .highlight .kd {
      color: #007020;
      font-weight: bold
    }

    .highlight .kn {
      color: #007020;
      font-weight: bold
    }

    .highlight .kp {
      color: #007020
    }

    .highlight .kr {
      color: #007020;
      font-weight: bold
    }

    .highlight .kt {
      color: #902000
    }

    .highlight .m {
      color: #40a070
    }

    .highlight .s {
      color: #4070a0
    }

    .highlight .na {
      color: #4070a0
    }

    .highlight .nb {
      color: #007020
    }

    .highlight .nc {
      color: #0e84b5;
      font-weight: bold
    }

    .highlight .no {
      color: #60add5
    }

    .highlight .nd {
      color: #555555;
      font-weight: bold
    }

    .highlight .ni {
      color: #d55537;
      font-weight: bold
    }

    .highlight .ne {
      color: #007020
    }

    .highlight .nf {
      color: #06287e
    }

    .highlight .nl {
      color: #002070;
      font-weight: bold
    }

    .highlight .nn {
      color: #0e84b5;
      font-weight: bold
    }

    .highlight .nt {
      color: #062873;
      font-weight: bold
    }

    .highlight .nv {
      color: #bb60d5
    }

    .highlight .ow {
      color: #007020;
      font-weight: bold
    }

    .highlight .w {
      color: #bbbbbb
    }

    .highlight .mb {
      color: #40a070
    }

    .highlight .mf {
      color: #40a070
    }

    .highlight .mh {
      color: #40a070
    }

    .highlight .mi {
      color: #40a070
    }

    .highlight .mo {
      color: #40a070
    }

    .highlight .sa {
      color: #4070a0
    }

    .highlight .sb {
      color: #4070a0
    }

    .highlight .sc {
      color: #4070a0
    }

    .highlight .dl {
      color: #4070a0
    }

    .highlight .sd {
      color: #4070a0;
      font-style: italic
    }

    .highlight .s2 {
      color: #4070a0
    }

    .highlight .se {
      color: #4070a0;
      font-weight: bold
    }

    .highlight .sh {
      color: #4070a0
    }

    .highlight .si {
      color: #70a0d0;
      font-style: italic
    }

    .highlight .sx {
      color: #c65d09
    }

    .highlight .sr {
      color: #235388
    }

    .highlight .s1 {
      color: #4070a0
    }

    .highlight .ss {
      color: #517918
    }

    .highlight .bp {
      color: #007020
    }

    .highlight .fm {
      color: #06287e
    }

    .highlight .vc {
      color: #bb60d5
    }

    .highlight .vg {
      color: #bb60d5
    }

    .highlight .vi {
      color: #bb60d5
    }

    .highlight .vm {
      color: #bb60d5
    }

    .highlight .il {
      color: #40a070
    }
  </style>
</head>

<body>
  <nav class="back-to-home">
  <p><a href="/">← Posts</a></h1></p>
</nav>

<header class="article-header">
  <h1>How to manage your Git history: Tips for keeping your commits tidy</h1>
  <time datetime="2018-12-11">11th December 2018</time>
</header>

<nav class="headings">
  <ol>
    <li><a href="#top">↑ top</a></li>
  </ol>
</nav>

<article>
  <p>One of the things we’re <a href="https://github.com/canonical-webteam/practices/pull/138">currently working
on</a> in the web and
design team is a page about writing Git commit messages for our <a href="https://canonical-webteam.github.io/practices/">team practices
website</a> (I hope to write more
about the practices website itself in the coming days).</p>

<p>As part of that discussion, we jotted down some quick tips for managing your
commit history to tell a neat story with your commit messages, which I’ll share
below.</p>

<p>These are the techniques I’ll discuss below:</p>

<ul>
  <li>Frequently run <code class="language-plaintext highlighter-rouge">git pull --rebase upstream master</code></li>
  <li>Don’t use <code class="language-plaintext highlighter-rouge">git commit --all</code></li>
  <li>Make use of <code class="language-plaintext highlighter-rouge">git add --patch {file}</code></li>
  <li>Amend previous commits with <code class="language-plaintext highlighter-rouge">git commit --amend --no-edit</code></li>
  <li>Reorder commits with <code class="language-plaintext highlighter-rouge">git rebase -i</code></li>
</ul>

<p>I’ll elaborate more on each, and why they’re helpful, below.</p>

<h3 id="why-change-commit-history">Why change commit history?</h3>

<p>Your Git commit history should be clear and descriptive — it should read like a
logical set of steps that explain how the project got to its current state,
where each commit defined one single, small but complete enhancement.</p>

<blockquote>
  <p><em>Who controls the past controls the future. Who controls the present controls
the past.</em></p>

  <p><em>“1984” by George Orwell</em></p>
</blockquote>

<p>However, when we’re doing the work it is rarely so neat. We might create a new
class in one commit but then 4 commits later realise we need to change the name
of the class, or fix a typo. If you haven’t yet merged your work, it would be
best to update the original commit where you did the original work with the fix,
to tell a simple and clear story.</p>

<p>Bear in mind that this means <a href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History">rewriting
history</a>, which is
very problematic if the history is shared. Therefore, <em>you should only do this
while you have complete ownership over the history being rewritten</em>. For
example, if your commits are still only local to your computer, or if they are
in a feature branch owned by you that hasn’t yet been merged with the central
repository.</p>

<p><img src="https://assets.ubuntu.com/v1/8f90595a-20181211_152357.jpg?w=800" alt="Only rewrite history in spaces you control" /><br />
<em>Only rewrite history in places that you fully control</em></p>

<p>In <a href="https://canonical-webteam.github.io/practices/workflow/github.html">our workflow</a>,
we do all new work on <a href="https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow">feature branches</a>
on our own <a href="https://help.github.com/articles/fork-a-repo/">forks</a> of the central
repository. These feature branches are therefore wholly owned by the person
working on that feature. So in our case, we use the below tips <em>only</em> to tidy up
our Git commits in our feature branches before merging our work into the central
repository.</p>

<p>After we’ve rewritten history on one of our feature branches, we may then need
to run <code class="language-plaintext highlighter-rouge">git push --force</code> to force the remote version of the feature branch to
use our rewritten version of history. But it’s very important to only ever <code class="language-plaintext highlighter-rouge">git
push --force</code> to <em>overwrite new work on a feature branch that you wholly
control</em>.</p>

<h3 id="mastering-your-history">Mastering your history</h3>

<p>These are some tricks I use for tidying up the Git commit history on my feature
branches as I work, so they tell a neat story.</p>

<h3 id="frequently-rebasing-from-master">Frequently rebasing from <code class="language-plaintext highlighter-rouge">master</code></h3>

<p>If you work on feature branches, like we do, that are based off a parent branch
(e.g. the <code class="language-plaintext highlighter-rouge">master</code> branch of the main repository), you want to avoid your branch
getting out of sync with the latest work in the parent branch.</p>

<p>As time goes by, your forked branch where you’re working can become
significantly out of sync with the latest <code class="language-plaintext highlighter-rouge">master</code> branch. This may mean that
merging your work when you’ve finished might become very tricky. You can avoid
this by frequently running:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull <span class="nt">--rebase</span> upstream master
</code></pre></div></div>

<p>(where <code class="language-plaintext highlighter-rouge">upstream</code> is the name of the remote pointing to your central repository,
and <code class="language-plaintext highlighter-rouge">master</code> is your parent branch).</p>

<p>This will grab any new commits from the <code class="language-plaintext highlighter-rouge">master</code> branch, and then add all the
commits in your feature branch on top of them. This keeps everything in a clear
logical order.</p>

<p>If you can, you should also run <code class="language-plaintext highlighter-rouge">git pull --rebase upstream master</code> just before
your feature is merged into <code class="language-plaintext highlighter-rouge">master</code>. This will help the history in <code class="language-plaintext highlighter-rouge">master</code>
stay chronological, rather than branching too often.</p>

<h3 id="commiting-files-explicitly">Commiting files explicitly</h3>

<p>Try to avoid using <code class="language-plaintext highlighter-rouge">git commit --all</code> (or <code class="language-plaintext highlighter-rouge">git commit -a</code>). This creates a
commit that automatically includes all existing changes for currently tracked
files (it won’t add changes from files that aren’t yet tracked).</p>

<p>By doing this you miss a chance to consider how your work could be logically
grouped into multiple commits. It can also easily lead to errors, because you
might easily accidentally include changes you weren’t aware of, and forget to
include new files that aren’t currently tracked.</p>

<p>Instead, try to get into the habit of checking which files are actually changed
(with <code class="language-plaintext highlighter-rouge">git status</code>), and then adding files to your commits explicitly:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="o">{</span>file1<span class="o">}</span> <span class="o">{</span>file2<span class="o">}</span> git commit
</code></pre></div></div>

<h3 id="separating-changes-within-the-same-file">Separating changes within the same file</h3>

<p>You can explicitly choose which changes to add to a commit with the <code class="language-plaintext highlighter-rouge">--patch</code>
command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="nt">--patch</span> <span class="o">{</span>file<span class="o">}</span>
</code></pre></div></div>

<p>This will open an interactive menu for each block of the diff on that file, so
you can choose to add work to the commit bit by bit. This means, for example,
that if you solved one problem at the top of the file and another problem at the
bottom, you can easily add the first change to one commit and the second change
to another.</p>

<p>You can even manually edit the diff to choose what to add line by line, or even
change the diff completely.</p>

<h3 id="add-changes-to-the-previous-commit">Add changes to the previous commit</h3>

<p>If you’ve created a commit already, but then you do more work that should
logically be included in that same commit, you can simply add new work to the
previous commit with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="o">{</span>file<span class="o">}</span> git commit <span class="nt">--amend</span> <span class="nt">--no-edit</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">--no-edit</code> command means you don’t want to change the commit message. You
can also omit this if you want to change the description of the commit.</p>

<h3 id="reordering-commits-with-interactive-rebasing">Reordering commits with interactive rebasing</h3>

<p>Let’s say:</p>

<ol>
  <li>You do some work in <code class="language-plaintext highlighter-rouge">users.js</code> and you commit it with “Improve user logic”</li>
  <li>You do some work in <code class="language-plaintext highlighter-rouge">README.md</code> and you commit it with “Explain user logic
better in README”</li>
  <li>Now you realise you need another fix to your <code class="language-plaintext highlighter-rouge">users.js</code> work. You want it to be
added to the “Improve user logic” commit, so do this:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git add users.js
<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s1">'... to be rebased'</span>
<span class="nv">$ </span>git rebase <span class="nt">-i</span> HEAD~3 <span class="c"># Interactively rebase the last 3 commits</span>
</code></pre></div></div>

<p>This will open an editor with these contents:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pick 239d4c3 Improve user logic
pick adc7c21 Explain user logic better in README
pick fd4f81b ... to be rebased
</code></pre></div></div>

<p>Now if we reorder our commits to move line 3 to line 2, and replace “pick” with
“squash” (or simply “s”), then it will “squash” the “… to be rebased” commit
into the “Improve user logic” one:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pick 239d4c3 Improve user logic
squash fd4f81b ... to be rebased
pick adc7c21 Explain user logic better in README
</code></pre></div></div>

<p>Save and exit, and the commit to “squash” will be combined with the commit above
it, to form a new commit. Another editor window will open for you can edit the
commit message for the new commit:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># This is a combination of 2 commits.
# This is the 1st commit message:
Improve user logic
# This is the commit message #2:
... to be rebased
</code></pre></div></div>

<p>In this case we should just delete the second message, save and exit, and
voila!:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git log
commit b87706ed594c983841857b51923e499988760d41 (HEAD -&gt; master)
Author: Cody Pendant 
Date:   Fri Dec 7 11:05:54 2018 +0000

    Explain user logic better in README

commit da1e9d47073cdc3bf86d3658b2e020c7e37292c0
Author: Cody Pendant 
Date:   Fri Dec 7 11:05:40 2018 +0000

    Improve user logic
</code></pre></div></div>

<p>This process might seem complicated, but once you’ve done it a couple of times,
you’ll see that it actually doesn’t take long. When you get used to it it will
probably only take about 15–20 seconds.</p>

<p>There are of course some cases where commits can’t be neatly re-ordered
(although fewer than you’d think). In these cases, after you perform your
interactive rebase, you’ll get a conflict which you’ll have to resolve in the
normal way. You’ll quickly get a feel for which commits can be reordered and
which can’t, and if you think it’s going to be too much trouble, just don’t
bother starting. Or <code class="language-plaintext highlighter-rouge">git rebase --abort</code>.</p>

<p>You can also use interactive rebasing to remove commits, or combine multiple
commits into one.</p>

<h3 id="go-forth-and-rewrite-history-carefully">Go forth and rewrite history (carefully)</h3>

<p>Please consider these tricks as tools in your tool-box, to be used where
necessary. Different projects work differently, and so spending time carefully
crafting your commits may or may not be appropriate to your context.</p>

<p>Either way, hopefully these tricks can be useful to help you feel more in
control of your commit history.</p>

<p>Happy committing!</p>

<hr />

<p><em>Originally published at <a href="https://blog.ubuntu.com/2018/12/12/tricks-for-keeping-a-tidy-git-commit-history">blog.ubuntu.com</a> on December 12, 2018.</em></p>


  
</article>

<script>
  /**
   * Document outline
   */

  // Get elements
  let article = document.querySelector("article");
  let headings = document.querySelector(".headings");
  let list = headings.querySelector("ol");

  // Populate nav
  article.querySelectorAll("h1, h2").forEach(function (heading) {
    let item = document.createElement("li");
    item.classList.add(heading.tagName.toLowerCase());
    item.innerHTML = `<a href="#${heading.id}">${heading.textContent}</a>`;
    list.appendChild(item);
  });

  function toggleHeadings() {
    // Don't show if there's not space
    if (article.offsetLeft < 180) {
      headings.style.display = "none";
      return;
    }

    // More compact layout
    if (article.offsetLeft < 350) {
      list.style.marginRight = "1.5em";
    } else {
      list.style.marginRight = "6em";
    }

    let articleBounding = article.getBoundingClientRect();
    let rightOffset = document.body.offsetWidth - articleBounding.left;

    headings.style.display = "block";
    headings.style.right = rightOffset + "px";

    if (articleBounding.top > 0) {
      headings.style.top = articleBounding.top + "px";
    } else {
      headings.style.top = 0;
    }
  }

  window.addEventListener('scroll', toggleHeadings);
  window.addEventListener('resize', toggleHeadings);

  toggleHeadings();
</script>

<address class="author">
  By <a href="https://twitter.com/nottrobin">@nottrobin</a>
</address>





<nav class="more-posts">
  <h2>More posts</h2>
  
  <p>
    <a href="/blogging-from-my-phone-with-gitjournal">Blogging from my phone with GitJournal</a><br>
    <time datetime="2022-06-05">5th June 2022</time>
  </p>
  
  
  <p>
    <a href="/learning-lxd">How to use Linux Containers with LXD, and why you might want to</a><br>
    <time datetime="2019-02-04">4th February 2019</time>
  </p>
  
  
  <p>
    <a href="/a-terminal-users-thought-process">Command-line usability: A terminal user's thought process</a><br>
    <time datetime="2017-09-07">7th September 2017</time>
  </p>
  
</nav>


  <footer class="see-the-code">
    <a href="https://github.com/nottrobin/robinwinslow.uk">☵ See the code</a>
  </footer>

  <!-- Instant.page -->
  <script>
    let mouseoverTimer; let lastTouchTimestamp; const prefetches = new Set; const prefetchElement = document.createElement("link"); const isSupported = prefetchElement.relList && prefetchElement.relList.supports && prefetchElement.relList.supports("prefetch") && window.IntersectionObserver && "isIntersecting" in IntersectionObserverEntry.prototype; const allowQueryString = "instantAllowQueryString" in document.body.dataset; const allowExternalLinks = "instantAllowExternalLinks" in document.body.dataset; const useWhitelist = "instantWhitelist" in document.body.dataset; const mousedownShortcut = "instantMousedownShortcut" in document.body.dataset; const DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION = 1111; let delayOnHover = 65; let useMousedown = false; let useMousedownOnly = false; let useViewport = false; if ("instantIntensity" in document.body.dataset) { const intensity = document.body.dataset.instantIntensity; if (intensity.substr(0, "mousedown".length) == "mousedown") { useMousedown = true; if (intensity == "mousedown-only") { useMousedownOnly = true } } else if (intensity.substr(0, "viewport".length) == "viewport") { if (!(navigator.connection && (navigator.connection.saveData || navigator.connection.effectiveType && navigator.connection.effectiveType.includes("2g")))) { if (intensity == "viewport") { if (document.documentElement.clientWidth * document.documentElement.clientHeight < 45e4) { useViewport = true } } else if (intensity == "viewport-all") { useViewport = true } } } else { const milliseconds = parseInt(intensity); if (!isNaN(milliseconds)) { delayOnHover = milliseconds } } } if (isSupported) { const eventListenersOptions = { capture: true, passive: true }; if (!useMousedownOnly) { document.addEventListener("touchstart", touchstartListener, eventListenersOptions) } if (!useMousedown) { document.addEventListener("mouseover", mouseoverListener, eventListenersOptions) } else if (!mousedownShortcut) { document.addEventListener("mousedown", mousedownListener, eventListenersOptions) } if (mousedownShortcut) { document.addEventListener("mousedown", mousedownShortcutListener, eventListenersOptions) } if (useViewport) { let triggeringFunction; if (window.requestIdleCallback) { triggeringFunction = (callback => { requestIdleCallback(callback, { timeout: 1500 }) }) } else { triggeringFunction = (callback => { callback() }) } triggeringFunction(() => { const intersectionObserver = new IntersectionObserver(entries => { entries.forEach(entry => { if (entry.isIntersecting) { const linkElement = entry.target; intersectionObserver.unobserve(linkElement); preload(linkElement.href) } }) }); document.querySelectorAll("a").forEach(linkElement => { if (isPreloadable(linkElement)) { intersectionObserver.observe(linkElement) } }) }) } } function touchstartListener(event) { lastTouchTimestamp = performance.now(); const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } preload(linkElement.href) } function mouseoverListener(event) { if (performance.now() - lastTouchTimestamp < DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION) { return } const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } linkElement.addEventListener("mouseout", mouseoutListener, { passive: true }); mouseoverTimer = setTimeout(() => { preload(linkElement.href); mouseoverTimer = undefined }, delayOnHover) } function mousedownListener(event) { const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } preload(linkElement.href) } function mouseoutListener(event) { if (event.relatedTarget && event.target.closest("a") == event.relatedTarget.closest("a")) { return } if (mouseoverTimer) { clearTimeout(mouseoverTimer); mouseoverTimer = undefined } } function mousedownShortcutListener(event) { if (performance.now() - lastTouchTimestamp < DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION) { return } const linkElement = event.target.closest("a"); if (event.which > 1 || event.metaKey || event.ctrlKey) { return } if (!linkElement) { return } linkElement.addEventListener("click", function (event) { if (event.detail == 1337) { return } event.preventDefault() }, { capture: true, passive: false, once: true }); const customEvent = new MouseEvent("click", { view: window, bubbles: true, cancelable: false, detail: 1337 }); linkElement.dispatchEvent(customEvent) } function isPreloadable(linkElement) { if (!linkElement || !linkElement.href) { return } if (useWhitelist && !("instant" in linkElement.dataset)) { return } if (!allowExternalLinks && linkElement.origin != location.origin && !("instant" in linkElement.dataset)) { return } if (!["http:", "https:"].includes(linkElement.protocol)) { return } if (linkElement.protocol == "http:" && location.protocol == "https:") { return } if (!allowQueryString && linkElement.search && !("instant" in linkElement.dataset)) { return } if (linkElement.hash && linkElement.pathname + linkElement.search == location.pathname + location.search) { return } if ("noInstant" in linkElement.dataset) { return } return true } function preload(url) { if (prefetches.has(url)) { return } const prefetcher = document.createElement("link"); prefetcher.rel = "prefetch"; prefetcher.href = url; document.head.appendChild(prefetcher); prefetches.add(url) }
  </script>
</body>

</html>
