<!doctype html>

<!--
## Features:

- Keep CSS inline: It will be small enough not to add much weight to the page, which means it's better to avoid the extra HTTP call to request CSS
- Use system fonts: But it's hard to find a nice system font for both Linux, Windows and MacOS

- Google colours for links
- Visual box around article to highlight it
- Navigation - don't get in the way
- 

JavaScript:

- Only use enhancements that aren't necessary:
  - Document outline on the left
  - Add "title" to links

-->

<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Using a virtual environment with Python 3.4</title>

  <meta name="description" content="I recently started learning Python and Django, and so I've been working out how to setup a good virtual environment. Here's how to do it the native way in Python 3.4.">

  <!-- Social media -->
  <meta property='article:author' content='https://twitter.com/nottrobin' />
  <meta property='article:publisher' content='https://robinwinslow.uk' />
  <meta property="og:image" content="https://www.thebluediamondgallery.com/tablet/images/blog.jpg" />
  <meta property="og:url" content="https://robinwinslow.uk/python-3-4-virtual-environment" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Using a virtual environment with Python 3.4" />
  <!-- Keep Terry Pratchett alive in the network https://xclacksoverhead.org/home/about -->
  <meta http-equiv="x-clacks-overhead" content="GNU Terry Pratchett" />

  <link type="application/atom+xml" rel="alternative" href="/rss.xml" />

  <style>
    /**
       * Font size
       * 
       * For usability, bigger text is almost always better. People continue to Especially as resolutions get higher
       * 
       */

    body {
      font-family: "dejavu Sans light", sans-serif;
      font-size: 1.5rem;
      background-color: #efefef;
      margin: 0;
    }

    time,
    .subtitle {
      color: #767676;
    }

    h1,
    h2,
    h3,
    h4 {
      font-weight: normal;
      margin-top: 2em;
      margin-bottom: 1em;
    }

    h1 {
      font-size: 2em;
    }

    h2 {
      font-size: 1.5em;
    }

    h3 {
      font-size: 1.2em;
    }

    h4 {
      font-size: 1.1em;
    }

    p {
      line-height: 1.5em;
    }

    a {
      color: #1a0dab;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    a:visited {
      color: #551A8B;
    }

    input,
    button {
      appearance: none;
      border: 1px solid lightgray;
      font-size: 1em;
      max-width: 100%;
      padding: 0.5em 0.8em;
    }

    article {
      margin: auto;
      padding: 3em 5em;
      max-width: 35em;
      background-color: white;
    }

    @media (max-width: 1080px) {
      article {
        padding: 0.5em 1.5em;
      }
    }

    article p,
    article ul,
    article ol {
      margin-block-start: 1.5em;
      margin-block-end: 1.5em;
    }

    article li {
      margin-block-start: 1em;
      margin-block-end: 1em;
      line-height: 1.5em;
    }

    blockquote {
      padding: 1em 1.5em;
      margin: 1.5em 0;
      border-left: 2px solid #ddd;
      font-style: italic;
    }

    blockquote p {
      display: inline;
    }

    pre {
      overflow-x: auto;
      background-color: #eee;
      padding: 1em;
      line-height: 125%;
    }

    img {
      max-width: 100%;
    }

    code {
      padding: 0.125em 0.25em;
      line-height: 1.6em;
      margin: 0;
      font-size: 0.8em;
      background-color: #f0f0f0;
      border-radius: 6px;
    }

    pre code {
      line-height: inherit;
      padding: 0;
    }

    hr {
      margin: 3em 0;
    }

    /* Classes */
    .article-header {
      margin: auto;
      max-width: 60em;
      padding: 3em 1em;
      text-align: center;
    }

    .article-header h1 {
      font-size: 3em;
      margin: 0 0 0.5em 0;
    }

    @media (max-width: 1080px) {
      .article-header h1 {
        font-size: 2.3em;
      }
    }

    .back-to-home {
      padding: 0 1.5em;
    }

    .title {
      text-align: center;
      margin: 1em 1em 2em 1em;
    }

    .title h1 {
      margin-bottom: 0;
    }

    .title p {
      margin-top: 0.25em;
    }

    .search-form {
      text-align: center;
      margin: 0.8em 1em;
    }

    .search-form input,
    .search-form button {
      margin: 0.2em 0;
    }

    .posts li {
      margin: 3em 0;
    }

    .posts li article {
      padding: 0.5em 3em;
    }

    .posts li article .date {
      margin-top: 0.5em;
      font-size: 0.8em;
    }

    @media (max-width: 984px) {
      .posts li article {
        padding: 1.5em;
      }
    }

    .posts li article h1 {
      font-size: 1.5em;
      margin: 1em 0 0 0;
      font-weight: normal;
    }

    @media (max-width: 984px) {
      .posts li article h1 {
        font-size: 1.3em;
      }
    }

    .posts {
      padding: 0;
      margin: 0;
      list-style-type: none;
    }

    .see-the-code {
      padding: 1.5em;
      font-size: 0.8em;
      text-align: right;
    }

    .discuss {
      text-align: center;
      font-style: italic;
    }

    .author {
      text-align: center;
      margin: 3em;
      font-style: normal;
    }

    .more-posts {
      padding: 1.5em 3em;
      margin: auto;
      background-color: white;
      max-width: 35em;
    }

    .more-posts h2 {
      margin-top: 1em;
    }

    .more-posts time {
      font-size: 0.8em;
    }

    .headings {
      position: absolute;
      text-align: right;
      font-size: 0.8em;
      opacity: 0.5;
      position: fixed;
      display: none;
    }

    .headings ol {
      margin: 6em 6em 1.5em 1.5em;
      padding: 0;
    }

    .headings ol li {
      list-style-type: none;
      margin: 1.5em 0 0 0;
    }

    .headings ol li.h2 {
      font-size: 0.8em;
      opacity: 0.8;
      margin: 0.7em 0 0 0;
    }

    .heading-link {
      opacity: 0.4;
      font-size: 2rem;
    }

    table {
      border-spacing: 0;
      font-size: 0.8em;
    }

    td {
      padding: 1em;
      border-left: 1px dotted #666;
      border-top: 1px dotted #666;
    }

    td:last-child {
      border-right: 1px dotted #666;
    }

    tr:last-child td {
      border-bottom: 1px dotted #666;
    }

    /* Pygments syntax highlighting autumn theme */
    td.linenos pre {
      color: #000000;
      background-color: #f0f0f0;
      padding-left: 5px;
      padding-right: 5px;
    }

    span.linenos {
      color: #000000;
      background-color: #f0f0f0;
      padding-left: 5px;
      padding-right: 5px;
    }

    td.linenos pre.special {
      color: #000000;
      background-color: #ffffc0;
      padding-left: 5px;
      padding-right: 5px;
    }

    span.linenos.special {
      color: #000000;
      background-color: #ffffc0;
      padding-left: 5px;
      padding-right: 5px;
    }

    .highlight .hll {
      background-color: #ffffcc
    }

    .highlight {
      background: #f0f0f0;
    }

    .highlight .c {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .err {
      border: 1px solid #FF0000
    }

    .highlight .k {
      color: #007020;
      font-weight: bold
    }

    .highlight .o {
      color: #666666
    }

    .highlight .ch {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cm {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cp {
      color: #007020
    }

    .highlight .cpf {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .c1 {
      color: #60a0b0;
      font-style: italic
    }

    .highlight .cs {
      color: #60a0b0;
      background-color: #fff0f0
    }

    .highlight .gd {
      color: #A00000
    }

    .highlight .ge {
      font-style: italic
    }

    .highlight .gr {
      color: #FF0000
    }

    .highlight .gh {
      color: #000080;
      font-weight: bold
    }

    .highlight .gi {
      color: #00A000
    }

    .highlight .go {
      color: #888888
    }

    .highlight .gp {
      color: #c65d09;
      font-weight: bold
    }

    .highlight .gs {
      font-weight: bold
    }

    .highlight .gu {
      color: #800080;
      font-weight: bold
    }

    .highlight .gt {
      color: #0044DD
    }

    .highlight .kc {
      color: #007020;
      font-weight: bold
    }

    .highlight .kd {
      color: #007020;
      font-weight: bold
    }

    .highlight .kn {
      color: #007020;
      font-weight: bold
    }

    .highlight .kp {
      color: #007020
    }

    .highlight .kr {
      color: #007020;
      font-weight: bold
    }

    .highlight .kt {
      color: #902000
    }

    .highlight .m {
      color: #40a070
    }

    .highlight .s {
      color: #4070a0
    }

    .highlight .na {
      color: #4070a0
    }

    .highlight .nb {
      color: #007020
    }

    .highlight .nc {
      color: #0e84b5;
      font-weight: bold
    }

    .highlight .no {
      color: #60add5
    }

    .highlight .nd {
      color: #555555;
      font-weight: bold
    }

    .highlight .ni {
      color: #d55537;
      font-weight: bold
    }

    .highlight .ne {
      color: #007020
    }

    .highlight .nf {
      color: #06287e
    }

    .highlight .nl {
      color: #002070;
      font-weight: bold
    }

    .highlight .nn {
      color: #0e84b5;
      font-weight: bold
    }

    .highlight .nt {
      color: #062873;
      font-weight: bold
    }

    .highlight .nv {
      color: #bb60d5
    }

    .highlight .ow {
      color: #007020;
      font-weight: bold
    }

    .highlight .w {
      color: #bbbbbb
    }

    .highlight .mb {
      color: #40a070
    }

    .highlight .mf {
      color: #40a070
    }

    .highlight .mh {
      color: #40a070
    }

    .highlight .mi {
      color: #40a070
    }

    .highlight .mo {
      color: #40a070
    }

    .highlight .sa {
      color: #4070a0
    }

    .highlight .sb {
      color: #4070a0
    }

    .highlight .sc {
      color: #4070a0
    }

    .highlight .dl {
      color: #4070a0
    }

    .highlight .sd {
      color: #4070a0;
      font-style: italic
    }

    .highlight .s2 {
      color: #4070a0
    }

    .highlight .se {
      color: #4070a0;
      font-weight: bold
    }

    .highlight .sh {
      color: #4070a0
    }

    .highlight .si {
      color: #70a0d0;
      font-style: italic
    }

    .highlight .sx {
      color: #c65d09
    }

    .highlight .sr {
      color: #235388
    }

    .highlight .s1 {
      color: #4070a0
    }

    .highlight .ss {
      color: #517918
    }

    .highlight .bp {
      color: #007020
    }

    .highlight .fm {
      color: #06287e
    }

    .highlight .vc {
      color: #bb60d5
    }

    .highlight .vg {
      color: #bb60d5
    }

    .highlight .vi {
      color: #bb60d5
    }

    .highlight .vm {
      color: #bb60d5
    }

    .highlight .il {
      color: #40a070
    }
  </style>
</head>

<body>
  <nav class="back-to-home">
  <p><a href="/">← Posts</a></h1></p>
</nav>

<header class="article-header">
  <h1>Using a virtual environment with Python 3.4</h1>
  <time datetime="2013-12-25">25th December 2013</time>
</header>

<nav class="headings">
  <ol>
    <li><a href="#top">↑ top</a></li>
  </ol>
</nav>

<article>
  <p>I’ve been learning Python recently. I had a choice between learning Python 2.7 or Python 3, and I chose the latter. It may be true that many people still work in Python 2.7, but I thought I should start off as up-to-date as possible.</p>

<p>This meant that I had to work out how to set up a virtual environment without virtualenv.</p>

<p>(Hopefully Python 3.3 <a href="https://wiki.ubuntu.com/Python/3">will finally be the default version</a> of Python in Ubuntu 14.04 LTS.)</p>

<h2 id="what-is-virtualenv">What is virtualenv?</h2>

<p><a href="https://pypi.python.org/pypi/virtualenv">Virtualenv</a> is a Python package that will setup a “virtual” python environment in a specific directory.</p>

<p>This virtual environment will keep your python version and modules separate from the system’s Python installation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>virtualenv <span class="nb">env</span>            <span class="c"># create new environment in "env" folder</span>
<span class="nv">$ </span><span class="nb">source env</span>/bin/activate   <span class="c"># Active "env"</span>
<span class="o">(</span><span class="nb">env</span><span class="o">)</span> <span class="nv">$ </span>which pip           <span class="c"># "pip" is now inside "env" folder</span>
<span class="nb">env</span>/bin/pip
<span class="o">(</span><span class="nb">env</span><span class="o">)</span> /project<span class="nv">$ </span>deactivate  <span class="c"># Deactivate env</span>
/project<span class="nv">$ </span>which pip         <span class="c"># "pip" is back to default</span>
/usr/bin/pip
</code></pre></div></div>

<p>This means that you can keep a fixed python environment fixed for a specific project regardless of whether the wider system changes. Virtual environments complement <a href="http://www.deploydjango.com/django_project_structure/index.html#step-2-define-your-requirements"><code class="language-plaintext highlighter-rouge">requirements files</code></a>.</p>

<p>When “env” is active, <code class="language-plaintext highlighter-rouge">pip install somemodule</code> will install “somemodule” into <code class="language-plaintext highlighter-rouge">env/lib/pythonx.x/site-packages</code> directory instead of the system’s normal python path.</p>

<p>This means that you can install exactly the modules you need for your current project and no more:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">source env</span>/bin/activate               <span class="c"># Activate a new environment</span>
<span class="o">(</span><span class="nb">env</span><span class="o">)</span> <span class="nv">$ </span>pip freeze                      <span class="c"># No output - clean environment</span>
<span class="o">(</span><span class="nb">env</span><span class="o">)</span> <span class="nv">$ </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt <span class="c"># Install project dependencies</span>
</code></pre></div></div>

<h2 id="python-3-and-pyvenv">Python 3 and pyvenv</h2>

<p>Virtualenv <a href="http://askubuntu.com/questions/279959/how-to-create-a-virtualenv-with-python3-3-in-ubuntu">doesn’t play nicely</a> with Python 3, so it’s best not to try to use it.</p>

<h3 id="pyvenv-33">pyvenv-3.3</h3>

<p>Fortunately, python 3.3 (the current version of the <a href="http://packages.ubuntu.com/saucy/python3">Ubuntu python3 package</a>) actually has a native virtual environment manager called <code class="language-plaintext highlighter-rouge">pyvenv</code>.</p>

<p>Unfortunately, the resulting environment <a href="http://stackoverflow.com/questions/17982032/pyvenv-pip-not-installing-into-local-site-packages">doesn’t include pip</a>. You can install pip into your virtual environment, but it’s all rather clunky.</p>

<h3 id="pyvenv-34">pyvenv-3.4</h3>

<p>Python 3.4’s version of <code class="language-plaintext highlighter-rouge">pyvenv</code> <a href="http://docs.python.org/dev/library/venv.html"><em>will</em></a> include <code class="language-plaintext highlighter-rouge">pip</code>, making management of virtual environments simple again, and now <em>native</em>.</p>

<p>The downside here is that Python 3.4 is still in beta, and I can’t find a PPA to install it through <code class="language-plaintext highlighter-rouge">apt-get</code> (the easy way).</p>

<h2 id="building-python-34-from-source">Building Python 3.4 from source</h2>

<p>Fortunately, building <a href="http://www.python.org/getit/releases/3.4.0/">Python 3.4.0-b1</a> from source was simple on Ubuntu 13.10:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>build-essential <span class="c"># Make sure we have build tools</span>
<span class="nv">$ </span>wget http://www.python.org/ftp/python/3.4.0/Python-3.4.0b1.tgz <span class="c"># download</span>
<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xzf</span> Python-3.4.0b1.tgz          <span class="c"># unzip</span>
<span class="nv">$ </span><span class="nb">cd </span>Python-3.4.0b1/                   <span class="c"># open directory</span>
<span class="nv">$ </span>./configure                          <span class="c"># configure for this system</span>
<span class="nv">$ </span>make                                 <span class="c"># build</span>
<span class="nv">$ </span><span class="nb">sudo </span>make <span class="nb">install</span>                    <span class="c"># install to /usr/local/</span>
</code></pre></div></div>

<p>You should now find you have a few new binaries (in <code class="language-plaintext highlighter-rouge">/usr/local/bin</code>) including <code class="language-plaintext highlighter-rouge">python3.4</code>, <code class="language-plaintext highlighter-rouge">pydoc3.4</code> and <code class="language-plaintext highlighter-rouge">pyvenv-3.4</code>.</p>

<h2 id="using-pyvenv-34">Using pyvenv-3.4</h2>

<p>Now that <code class="language-plaintext highlighter-rouge">pyvenv-3.4</code> is installed, here’s how you might use it to setup a Django environment and a django project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pyvenv-3.4 djenv          <span class="c"># create django virtual env</span>
<span class="nv">$ </span><span class="nb">source </span>djenv/bin/activate <span class="c"># activate it</span>
<span class="o">(</span>djenv<span class="o">)</span> <span class="nv">$ </span>which pip         <span class="c"># check pip points to the right place</span>
/home/me/djenv/bin/pip
<span class="o">(</span>djenv<span class="o">)</span> <span class="nv">$ </span>pip freeze        <span class="c"># check our environment is clean (no output)</span>
<span class="o">(</span>djenv<span class="o">)</span> <span class="nv">$ </span>pip <span class="nb">install </span>django django-extensions     <span class="c"># install django dependencies</span>
<span class="o">(</span>djenv<span class="o">)</span> <span class="nv">$ </span>pip freeze        <span class="c"># see our installed dependencies</span>
<span class="nv">Django</span><span class="o">==</span>1.6.1
django-extensions<span class="o">==</span>1.2.5
<span class="nv">six</span><span class="o">==</span>1.4.1
<span class="o">(</span>djenv<span class="o">)</span> <span class="nv">$ </span>django-admin.py startproject newproject  <span class="c"># create new django project</span>
<span class="o">(</span>djenv<span class="o">)</span> <span class="nv">$ </span>pip freeze <span class="o">&gt;</span> newproject/requirements.txt <span class="c"># save dependencies into project</span>
</code></pre></div></div>

<h2 id="the-future">The future</h2>

<p>While all the above setup isn’t <em>that</em> hard, I’m hoping that by 2015 we might see Python 3.4 become stable and become the default version of Python in Ubuntu 14.10.</p>

<p>After that, I guess the next thing would be for someone to create something similar to <a href="http://virtualenvwrapper.readthedocs.org/en/latest/">virtualenv wrapper</a> for <code class="language-plaintext highlighter-rouge">pyvenv</code>.</p>


  
</article>

<script>
  /**
   * Document outline
   */

  // Get elements
  let article = document.querySelector("article");
  let headings = document.querySelector(".headings");
  let list = headings.querySelector("ol");

  // Populate nav
  article.querySelectorAll("h1, h2").forEach(function (heading) {
    let item = document.createElement("li");
    item.classList.add(heading.tagName.toLowerCase());
    item.innerHTML = `<a href="#${heading.id}">${heading.textContent}</a>`;
    list.appendChild(item);
  });

  function toggleHeadings() {
    // Don't show if there's not space
    if (article.offsetLeft < 180) {
      headings.style.display = "none";
      return;
    }

    // More compact layout
    if (article.offsetLeft < 350) {
      list.style.marginRight = "1.5em";
    } else {
      list.style.marginRight = "6em";
    }

    let articleBounding = article.getBoundingClientRect();
    let rightOffset = document.body.offsetWidth - articleBounding.left;

    headings.style.display = "block";
    headings.style.right = rightOffset + "px";

    if (articleBounding.top > 0) {
      headings.style.top = articleBounding.top + "px";
    } else {
      headings.style.top = 0;
    }
  }

  window.addEventListener('scroll', toggleHeadings);
  window.addEventListener('resize', toggleHeadings);

  toggleHeadings();
</script>

<address class="author">
  By <a href="https://twitter.com/nottrobin">@nottrobin</a>
</address>





<nav class="more-posts">
  <h2>More posts</h2>
  
  <p>
    <a href="/blogging-from-my-phone-with-gitjournal">Blogging from my phone with GitJournal</a><br>
    <time datetime="2022-06-05">5th June 2022</time>
  </p>
  
  
  <p>
    <a href="/summary-of-python-code-style-conventions">A summary of python code style conventions</a><br>
    <time datetime="2014-01-04">4th January 2014</time>
  </p>
  
  
  <p>
    <a href="/giffgaff-time-to-untether">GiffGaff - Time to untether</a><br>
    <time datetime="2013-12-24">24th December 2013</time>
  </p>
  
</nav>


  <footer class="see-the-code">
    <a href="https://github.com/nottrobin/robinwinslow.uk">☵ See the code</a>
  </footer>

  <!-- Instant.page -->
  <script>
    let mouseoverTimer; let lastTouchTimestamp; const prefetches = new Set; const prefetchElement = document.createElement("link"); const isSupported = prefetchElement.relList && prefetchElement.relList.supports && prefetchElement.relList.supports("prefetch") && window.IntersectionObserver && "isIntersecting" in IntersectionObserverEntry.prototype; const allowQueryString = "instantAllowQueryString" in document.body.dataset; const allowExternalLinks = "instantAllowExternalLinks" in document.body.dataset; const useWhitelist = "instantWhitelist" in document.body.dataset; const mousedownShortcut = "instantMousedownShortcut" in document.body.dataset; const DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION = 1111; let delayOnHover = 65; let useMousedown = false; let useMousedownOnly = false; let useViewport = false; if ("instantIntensity" in document.body.dataset) { const intensity = document.body.dataset.instantIntensity; if (intensity.substr(0, "mousedown".length) == "mousedown") { useMousedown = true; if (intensity == "mousedown-only") { useMousedownOnly = true } } else if (intensity.substr(0, "viewport".length) == "viewport") { if (!(navigator.connection && (navigator.connection.saveData || navigator.connection.effectiveType && navigator.connection.effectiveType.includes("2g")))) { if (intensity == "viewport") { if (document.documentElement.clientWidth * document.documentElement.clientHeight < 45e4) { useViewport = true } } else if (intensity == "viewport-all") { useViewport = true } } } else { const milliseconds = parseInt(intensity); if (!isNaN(milliseconds)) { delayOnHover = milliseconds } } } if (isSupported) { const eventListenersOptions = { capture: true, passive: true }; if (!useMousedownOnly) { document.addEventListener("touchstart", touchstartListener, eventListenersOptions) } if (!useMousedown) { document.addEventListener("mouseover", mouseoverListener, eventListenersOptions) } else if (!mousedownShortcut) { document.addEventListener("mousedown", mousedownListener, eventListenersOptions) } if (mousedownShortcut) { document.addEventListener("mousedown", mousedownShortcutListener, eventListenersOptions) } if (useViewport) { let triggeringFunction; if (window.requestIdleCallback) { triggeringFunction = (callback => { requestIdleCallback(callback, { timeout: 1500 }) }) } else { triggeringFunction = (callback => { callback() }) } triggeringFunction(() => { const intersectionObserver = new IntersectionObserver(entries => { entries.forEach(entry => { if (entry.isIntersecting) { const linkElement = entry.target; intersectionObserver.unobserve(linkElement); preload(linkElement.href) } }) }); document.querySelectorAll("a").forEach(linkElement => { if (isPreloadable(linkElement)) { intersectionObserver.observe(linkElement) } }) }) } } function touchstartListener(event) { lastTouchTimestamp = performance.now(); const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } preload(linkElement.href) } function mouseoverListener(event) { if (performance.now() - lastTouchTimestamp < DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION) { return } const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } linkElement.addEventListener("mouseout", mouseoutListener, { passive: true }); mouseoverTimer = setTimeout(() => { preload(linkElement.href); mouseoverTimer = undefined }, delayOnHover) } function mousedownListener(event) { const linkElement = event.target.closest("a"); if (!isPreloadable(linkElement)) { return } preload(linkElement.href) } function mouseoutListener(event) { if (event.relatedTarget && event.target.closest("a") == event.relatedTarget.closest("a")) { return } if (mouseoverTimer) { clearTimeout(mouseoverTimer); mouseoverTimer = undefined } } function mousedownShortcutListener(event) { if (performance.now() - lastTouchTimestamp < DELAY_TO_NOT_BE_CONSIDERED_A_TOUCH_INITIATED_ACTION) { return } const linkElement = event.target.closest("a"); if (event.which > 1 || event.metaKey || event.ctrlKey) { return } if (!linkElement) { return } linkElement.addEventListener("click", function (event) { if (event.detail == 1337) { return } event.preventDefault() }, { capture: true, passive: false, once: true }); const customEvent = new MouseEvent("click", { view: window, bubbles: true, cancelable: false, detail: 1337 }); linkElement.dispatchEvent(customEvent) } function isPreloadable(linkElement) { if (!linkElement || !linkElement.href) { return } if (useWhitelist && !("instant" in linkElement.dataset)) { return } if (!allowExternalLinks && linkElement.origin != location.origin && !("instant" in linkElement.dataset)) { return } if (!["http:", "https:"].includes(linkElement.protocol)) { return } if (linkElement.protocol == "http:" && location.protocol == "https:") { return } if (!allowQueryString && linkElement.search && !("instant" in linkElement.dataset)) { return } if (linkElement.hash && linkElement.pathname + linkElement.search == location.pathname + location.search) { return } if ("noInstant" in linkElement.dataset) { return } return true } function preload(url) { if (prefetches.has(url)) { return } const prefetcher = document.createElement("link"); prefetcher.rel = "prefetch"; prefetcher.href = url; document.head.appendChild(prefetcher); prefetches.add(url) }
  </script>
</body>

</html>
